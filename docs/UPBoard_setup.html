---

title: Setting up an UPboard

keywords: fastai
sidebar: home_sidebar

summary: "A guide for setting up and [Upboard Intel SBC](https://up-board.org/upsquared/specifications/)"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/80_UPBoard_setup.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Ubuntu-18.04">Ubuntu 18.04<a class="anchor-link" href="#Ubuntu-18.04">&#182;</a></h3><blockquote><p>The upboard come with Ubuntu 16.04. We decided to upgrade to 18.04</p>
</blockquote>
<p>Install ubuntu 18.04 from usb, on boot press F7 to set the boot sequence in necessary.<br>
Set up a user <code>rov</code> with a password</p>
<p><strong>Edit grub file</strong>     - to set USB memory and file system check and repair</p>
<p><code>sudo nano /etc/default/grub</code></p>
<p>Find and replace</p>

<pre><code>GRUB_CMDLINE_LINUX_DEFAULT="quiet splash usbcore.usbfs_memory_mb=1000"
GRUB_CMDLINE_LINUX="reboot=efi fsck.mode=force fsck.repair=yes"
GRUB_TIMEOUT=5</code></pre>
<p>Update the grub file</p>

<pre><code>sudo update-grub
sudo reboot</code></pre>
<p>To test that buffer_mb = 1000<br>
<code>cat /sys/module/usbcore/parameters/usbfs_memory_mb</code><br>
Check fsck boot log<br>
<code>journalctl -u systemd-fsck*</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Install-SSH">Install SSH<a class="anchor-link" href="#Install-SSH">&#182;</a></h3><blockquote><p>To allow remote terminal access</p>
</blockquote>
<p><code>sudo apt install openssh-server</code><br>
Connect remotely with ethernet cable and find the upboard  address with<br>
<code>arp -a</code><br>
Connect to the upboard rov user with the found address i.e <code>10.42.0.114</code><br>
<code>ssh rov@10.42.0.114</code><br>
If you get "Host key verification failed"
<code>ssh-keygen -R hostname</code>             i.e ssh-keygen -R 10.42.0.114</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Install-SAMBA">Install SAMBA<a class="anchor-link" href="#Install-SAMBA">&#182;</a></h3><blockquote><p>optional but allows easy file copy to and from the rov via pc<br>
https: //magpi.raspberrypi.org/articles/samba-file-server</p>
</blockquote>

<pre><code>sudo apt-get update
sudo apt-get upgrade
sudo apt-get install samba samba-common-bin</code></pre>
<p>Edit the smb config file<br>
<code>sudo nano /etc/samba/smb.conf</code></p>

<pre><code>[sambashare]
Comment = Rov shared folder
Path = /home/rov
Browseable = yes
Writeable = Yes
only guest = no
create mask = 0777
directory mask = 0777
Public = yes
Guest ok = yes</code></pre>
<p>Password &amp; restart<br>
<code>sudo smbpasswd -a rov</code><br>
<code>sudo /etc/init.d/samba restart</code><br>
From the pc with file navigator or explorer connect to <code>smb://10.42.0.xxx/sambashare</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Install-Ubuntu-kernel-4.15.0-7-&amp;-mraa">Install Ubuntu kernel 4.15.0 7 &amp; mraa<a class="anchor-link" href="#Install-Ubuntu-kernel-4.15.0-7-&amp;-mraa">&#182;</a></h3><blockquote><p>for UP from PPA on Ubuntu 18.04  - to enable GPIO 
(see https: //wiki.up-community.org/Ubuntu)</p>
</blockquote>

<pre><code>sudo add-apt-repository ppa:ubilinux/up
sudo apt update
sudo apt-get autoremove --purge 'linux-.*generic'   (type no to abort removal)
sudo apt-get install linux-image-generic-hwe-18.04-upboard
sudo apt dist-upgrade -y
sudo reboot</code></pre>
<p><strong>Install mraa</strong>  - to enable GPIO  (see <a href="https://wiki.up-community.org/MRAA/UPM">https://wiki.up-community.org/MRAA/UPM</a>)</p>

<pre><code>sudo add-apt-repository ppa:mraa/mraa
sudo apt-get update
sudo apt-get install mraa-tools mraa-examples libmraa1 libmraa-dev libupm-dev libupm1 upm-examples
sudo apt-get install python-mraa python3-mraa node-mraa libmraa-java</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Install-virtualenv-and-CV2">Install virtualenv and CV2<a class="anchor-link" href="#Install-virtualenv-and-CV2">&#182;</a></h3><blockquote><p>optional to keep python dependencies separate</p>
</blockquote>
<p>see https: //itnext.io/virtualenv-with-virtualenvwrapper-on-ubuntu-18-04-goran-aviani-d7b712d906d5</p>

<pre><code>sudo apt install python3-pip
pip3 install virtualenv virtualenvwrapper
nano ~/.bashrc</code></pre>
<p>add these to the end of the file</p>

<pre><code>#Virtualenvwrapper settings:
export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3
export WORKON_HOME=$HOME/.virtualenvs
export VIRTUALENVWRAPPER_VIRTUALENV=/home/rov/.local/bin/virtualenv
source ~/.local/bin/virtualenvwrapper.sh</code></pre>
<p>Run<br>
<code>source ~/.bashrc</code></p>
<p>Make a virtualenv for the camera server</p>

<pre><code>mkvirtualenv flir
Workon flir</code></pre>
<p><strong>Install CV2</strong></p>

<pre><code>sudo apt install python3-opencv
# optional install
sudo apt-get install libopencv-dev
pip install opencv-contrib-python</code></pre>
<p>To test</p>

<pre><code>python
import cv2</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Install-FLIR-camera-Spinaker-&amp;-python-sdk">Install FLIR camera Spinaker &amp; python sdk<a class="anchor-link" href="#Install-FLIR-camera-Spinaker-&amp;-python-sdk">&#182;</a></h3><blockquote><p>FLIR camera drivers</p>
</blockquote>
<p>Download spinaker amd64 from
<code>https: //flir.app.boxcn.net/v/SpinnakerSDK/folder/74729115388</code>  Extract to a director such as  <code>home/rov/spinnaker-1.27.0.48-amd64</code><br>
Follow instructions in readme i.e</p>

<pre><code>cd ~/spinnaker-1.27.0.48-amd64
sudo sh install_spinnaker.sh        # add rov as a user</code></pre>
<p>Download Python sdk<br>
<a href="https://flir.app.boxcn.net/v/SpinnakerSDK/folder/74728781416">https://flir.app.boxcn.net/v/SpinnakerSDK/folder/74728781416</a></p>

<pre><code>workon flir
cd ~/git/FLIR-pubsub/run
python -m pip install spinnaker_python-1.27.0.48-cp36-cp36m-linux_x86_64.whl</code></pre>
<p>You may need to reboot to allow usb driver to work on user rov</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Install-the-FLIR-server-from-github">Install the FLIR server from github<a class="anchor-link" href="#Install-the-FLIR-server-from-github">&#182;</a></h3><blockquote><p>The the server polls connected cameras and runs them depending on client demand.<br>
It requires a yaml file for each camera connected.</p>
</blockquote>

<pre><code>sudo apt install git
git clone https: //github.com/johnnewto/FLIR_pubsub.git</code></pre>
<p><strong>To run server</strong></p>

<pre><code>workon flir 
cd ~/git/FLIR-pubsub/run
python flir-server.py</code></pre>
<p><strong>To install as a service</strong><br>
<a href="https://www.raspberrypi.org/documentation/linux/usage/systemd.md">https://www.raspberrypi.org/documentation/linux/usage/systemd.md</a></p>

<pre><code>sudo cp flir-server.service /etc/systemd/system/flir-server.service
sudo systemctl start flir-server.service
sudo systemctl stop flir-server.service
sudo systemctl enable flir-server.service   # enable at boot</code></pre>
<p>To show status of the service<br>
<code>sudo systemctl status flir-server.service</code><br>
To show fsck log<br>
<code>journalctl -u systemd-fsck*</code></p>
<p>You will need to set up the camera yaml files<br>
see <a href="https://johnnewto.github.io/FLIR_pubsub/FLIR_server_utils/#Camera-yaml-files">Camera-yaml-files</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

</div>
</div>
</div>
</div>
 

